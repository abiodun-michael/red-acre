<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>require("dotenv").config()
import express from "express";
import { indexRouter, transactionRouter } from "@routes";
import dbConnection from "@database";
import event from '@events'
import * as http from 'http';
import * as WebSocket from 'ws';


/**
 * Create a store for all connected client
 */
const clients = new Set()

/**
 * Use available port in the system environment
 */
const PORT = process.env.PORT || 4000

/**
 * create instance of express app
 * Attach it to an http server and pass it to instance of websocket server
 */
const app = express()
const server = http.createServer(app)
const wss = new WebSocket.Server({ server });


app.use(express.json())

/**
 * pass all router to the express instance
 */
app.use("/",indexRouter)
app.use("/transactions",transactionRouter)

/**
 * Listen to client connection to socket and store
 * the client in the store created above
 */
wss.on('connection', (ws) => {
   clients.add(ws)
});


/**
 * Listen to send-data event from service
 * when a new exchange has been submitted either from
 * live or exchange and then run a loop over all the clients stored
 * in the store above and send it to them
 */
event.on("send-data",(data)=>{
    for(let client of clients){
        client.send(JSON.stringify(data))
    }
})

/**
 * invoke database connection factory function
 */
dbConnection({dbUrl:process.env.MONGO_URL})

/**
 * Listen the database connection and then
 * start the server
 */
event.on("db-connected",()=>{
    server.listen(PORT,()=>{
        console.log(`Server running on http://localhost:${PORT}`)
    })
})
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="TransactionService.html">TransactionService</a></li></ul><h3>Global</h3><ul><li><a href="global.html#app">app</a></li><li><a href="global.html#clients">clients</a></li><li><a href="global.html#dbConnection">dbConnection</a></li><li><a href="global.html#eventEmitter">eventEmitter</a></li><li><a href="global.html#exchange">exchange</a></li><li><a href="global.html#getAllTransactionHistory">getAllTransactionHistory</a></li><li><a href="global.html#liveExchangeHandler">liveExchangeHandler</a></li><li><a href="global.html#PORT">PORT</a></li><li><a href="global.html#TransactionSchema">TransactionSchema</a></li><li><a href="global.html#validateExchange">validateExchange</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Wed Aug 10 2022 18:50:46 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
